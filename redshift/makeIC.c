#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "constants.h"
#include "cosmology.h"
#include "redshift.h"

int main() {
  const double BB_temp = 1e6;

  double photon_energy[RT_NGROUPS];
  double integral_E[RT_NGROUPS];
  double integral_N[RT_NGROUPS];
  // double //frequency_bins[RT_NGROUPS] ={0, 200000000000000, 400000000000000, 600000000000000, 800000000000000, 1000000000000000, 1200000000000000, 1400000000000000, 1600000000000000, 1800000000000000, 2000000000000000, 2200000000000000, 2400000000000000, 2600000000000000, 2800000000000000, 3000000000000000, 3200000000000000, 3400000000000000, 3600000000000000, 3800000000000000, 4000000000000000, 4200000000000000, 4400000000000000, 4600000000000000, 4800000000000000, 5000000000000000, 5200000000000000, 5400000000000000, 5600000000000000, 5800000000000000, 6000000000000000, 6200000000000000, 6400000000000000, 6600000000000000, 6800000000000000, 7000000000000000, 7200000000000000, 7400000000000000, 7600000000000000, 7800000000000000, 8000000000000000, 8200000000000000, 8400000000000000, 8600000000000000, 8800000000000000, 9000000000000000, 9200000000000000, 9400000000000000, 9600000000000000, 9800000000000000, 10000000000000000, 10200000000000000, 10400000000000000, 10600000000000000, 10800000000000000, 11000000000000000, 11200000000000000, 11400000000000000, 11600000000000000, 11800000000000000, 12000000000000000, 12200000000000000, 12400000000000000, 12600000000000000, 12800000000000000, 13000000000000000, 13200000000000000, 13400000000000000, 13600000000000000, 13800000000000000, 14000000000000000, 14200000000000000, 14400000000000000, 14600000000000000, 14800000000000000, 15000000000000000, 15200000000000000, 15400000000000000, 15600000000000000, 15800000000000000, 16000000000000000, 16200000000000000, 16400000000000000, 16600000000000000, 16800000000000000, 17000000000000000, 17200000000000000, 17400000000000000, 17600000000000000, 17800000000000000, 18000000000000000, 18200000000000000, 18400000000000000, 18600000000000000, 18800000000000000, 19000000000000000, 19200000000000000, 19400000000000000, 19600000000000000, 19800000000000000, 20000000000000000}; 

  double frequency_bins[RT_NGROUPS] = {0, 2000000000000000, 4000000000000000, 6000000000000000, 8000000000000000, 10000000000000000, 12000000000000000, 14000000000000000, 16000000000000000, 18000000000000000, 20000000000000000};

  // double frequency_bins[RT_NGROUPS] = {0, 20000000000000, 40000000000000, 60000000000000, 80000000000000, 100000000000000, 120000000000000, 140000000000000, 160000000000000, 180000000000000, 200000000000000, 220000000000000, 240000000000000, 260000000000000, 280000000000000, 300000000000000, 320000000000000, 340000000000000, 360000000000000, 380000000000000, 400000000000000, 420000000000000, 440000000000000, 460000000000000, 480000000000000, 500000000000000, 520000000000000, 540000000000000, 560000000000000, 580000000000000, 600000000000000, 620000000000000, 640000000000000, 660000000000000, 680000000000000, 700000000000000, 720000000000000, 740000000000000, 760000000000000, 780000000000000, 800000000000000, 820000000000000, 840000000000000, 860000000000000, 880000000000000, 900000000000000, 920000000000000, 940000000000000, 960000000000000, 980000000000000, 1000000000000000, 1020000000000000, 1040000000000000, 1060000000000000, 1080000000000000, 1100000000000000, 1120000000000000, 1140000000000000, 1160000000000000, 1180000000000000, 1200000000000000, 1220000000000000, 1240000000000000, 1260000000000000, 1280000000000000, 1300000000000000, 1320000000000000, 1340000000000000, 1360000000000000, 1380000000000000, 1400000000000000, 1420000000000000, 1440000000000000, 1460000000000000, 1480000000000000, 1500000000000000, 1520000000000000, 1540000000000000, 1560000000000000, 1580000000000000, 1600000000000000, 1620000000000000, 1640000000000000, 1660000000000000, 1680000000000000, 1700000000000000, 1720000000000000, 1740000000000000, 1760000000000000, 1780000000000000, 1800000000000000, 1820000000000000, 1840000000000000, 1860000000000000, 1880000000000000, 1900000000000000, 1920000000000000, 1940000000000000, 1960000000000000, 1980000000000000, 2000000000000000, 2020000000000000, 2040000000000000, 2060000000000000, 2080000000000000, 2100000000000000, 2120000000000000, 2140000000000000, 2160000000000000, 2180000000000000, 2200000000000000, 2220000000000000, 2240000000000000, 2260000000000000, 2280000000000000, 2300000000000000, 2320000000000000, 2340000000000000, 2360000000000000, 2380000000000000, 2400000000000000, 2420000000000000, 2440000000000000, 2460000000000000, 2480000000000000, 2500000000000000, 2520000000000000, 2540000000000000, 2560000000000000, 2580000000000000, 2600000000000000, 2620000000000000, 2640000000000000, 2660000000000000, 2680000000000000, 2700000000000000, 2720000000000000, 2740000000000000, 2760000000000000, 2780000000000000, 2800000000000000, 2820000000000000, 2840000000000000, 2860000000000000, 2880000000000000, 2900000000000000, 2920000000000000, 2940000000000000, 2960000000000000, 2980000000000000, 3000000000000000, 3020000000000000, 3040000000000000, 3060000000000000, 3080000000000000, 3100000000000000, 3120000000000000, 3140000000000000, 3160000000000000, 3180000000000000, 3200000000000000, 3220000000000000, 3240000000000000, 3260000000000000, 3280000000000000, 3300000000000000, 3320000000000000, 3340000000000000, 3360000000000000, 3380000000000000, 3400000000000000, 3420000000000000, 3440000000000000, 3460000000000000, 3480000000000000, 3500000000000000, 3520000000000000, 3540000000000000, 3560000000000000, 3580000000000000, 3600000000000000, 3620000000000000, 3640000000000000, 3660000000000000, 3680000000000000, 3700000000000000, 3720000000000000, 3740000000000000, 3760000000000000, 3780000000000000, 3800000000000000, 3820000000000000, 3840000000000000, 3860000000000000, 3880000000000000, 3900000000000000, 3920000000000000, 3940000000000000, 3960000000000000, 3980000000000000, 4000000000000000, 4020000000000000, 4040000000000000, 4060000000000000, 4080000000000000, 4100000000000000, 4120000000000000, 4140000000000000, 4160000000000000, 4180000000000000, 4200000000000000, 4220000000000000, 4240000000000000, 4260000000000000, 4280000000000000, 4300000000000000, 4320000000000000, 4340000000000000, 4360000000000000, 4380000000000000, 4400000000000000, 4420000000000000, 4440000000000000, 4460000000000000, 4480000000000000, 4500000000000000, 4520000000000000, 4540000000000000, 4560000000000000, 4580000000000000, 4600000000000000, 4620000000000000, 4640000000000000, 4660000000000000, 4680000000000000, 4700000000000000, 4720000000000000, 4740000000000000, 4760000000000000, 4780000000000000, 4800000000000000, 4820000000000000, 4840000000000000, 4860000000000000, 4880000000000000, 4900000000000000, 4920000000000000, 4940000000000000, 4960000000000000, 4980000000000000, 5000000000000000, 5020000000000000, 5040000000000000, 5060000000000000, 5080000000000000, 5100000000000000, 5120000000000000, 5140000000000000, 5160000000000000, 5180000000000000, 5200000000000000, 5220000000000000, 5240000000000000, 5260000000000000, 5280000000000000, 5300000000000000, 5320000000000000, 5340000000000000, 5360000000000000, 5380000000000000, 5400000000000000, 5420000000000000, 5440000000000000, 5460000000000000, 5480000000000000, 5500000000000000, 5520000000000000, 5540000000000000, 5560000000000000, 5580000000000000, 5600000000000000, 5620000000000000, 5640000000000000, 5660000000000000, 5680000000000000, 5700000000000000, 5720000000000000, 5740000000000000, 5760000000000000, 5780000000000000, 5800000000000000, 5820000000000000, 5840000000000000, 5860000000000000, 5880000000000000, 5900000000000000, 5920000000000000, 5940000000000000, 5960000000000000, 5980000000000000, 6000000000000000, 6020000000000000, 6040000000000000, 6060000000000000, 6080000000000000, 6100000000000000, 6120000000000000, 6140000000000000, 6160000000000000, 6180000000000000, 6200000000000000, 6220000000000000, 6240000000000000, 6260000000000000, 6280000000000000, 6300000000000000, 6320000000000000, 6340000000000000, 6360000000000000, 6380000000000000, 6400000000000000, 6420000000000000, 6440000000000000, 6460000000000000, 6480000000000000, 6500000000000000, 6520000000000000, 6540000000000000, 6560000000000000, 6580000000000000, 6600000000000000, 6620000000000000, 6640000000000000, 6660000000000000, 6680000000000000, 6700000000000000, 6720000000000000, 6740000000000000, 6760000000000000, 6780000000000000, 6800000000000000, 6820000000000000, 6840000000000000, 6860000000000000, 6880000000000000, 6900000000000000, 6920000000000000, 6940000000000000, 6960000000000000, 6980000000000000, 7000000000000000, 7020000000000000, 7040000000000000, 7060000000000000, 7080000000000000, 7100000000000000, 7120000000000000, 7140000000000000, 7160000000000000, 7180000000000000, 7200000000000000, 7220000000000000, 7240000000000000, 7260000000000000, 7280000000000000, 7300000000000000, 7320000000000000, 7340000000000000, 7360000000000000, 7380000000000000, 7400000000000000, 7420000000000000, 7440000000000000, 7460000000000000, 7480000000000000, 7500000000000000, 7520000000000000, 7540000000000000, 7560000000000000, 7580000000000000, 7600000000000000, 7620000000000000, 7640000000000000, 7660000000000000, 7680000000000000, 7700000000000000, 7720000000000000, 7740000000000000, 7760000000000000, 7780000000000000, 7800000000000000, 7820000000000000, 7840000000000000, 7860000000000000, 7880000000000000, 7900000000000000, 7920000000000000, 7940000000000000, 7960000000000000, 7980000000000000, 8000000000000000, 8020000000000000, 8040000000000000, 8060000000000000, 8080000000000000, 8100000000000000, 8120000000000000, 8140000000000000, 8160000000000000, 8180000000000000, 8200000000000000, 8220000000000000, 8240000000000000, 8260000000000000, 8280000000000000, 8300000000000000, 8320000000000000, 8340000000000000, 8360000000000000, 8380000000000000, 8400000000000000, 8420000000000000, 8440000000000000, 8460000000000000, 8480000000000000, 8500000000000000, 8520000000000000, 8540000000000000, 8560000000000000, 8580000000000000, 8600000000000000, 8620000000000000, 8640000000000000, 8660000000000000, 8680000000000000, 8700000000000000, 8720000000000000, 8740000000000000, 8760000000000000, 8780000000000000, 8800000000000000, 8820000000000000, 8840000000000000, 8860000000000000, 8880000000000000, 8900000000000000, 8920000000000000, 8940000000000000, 8960000000000000, 8980000000000000, 9000000000000000, 9020000000000000, 9040000000000000, 9060000000000000, 9080000000000000, 9100000000000000, 9120000000000000, 9140000000000000, 9160000000000000, 9180000000000000, 9200000000000000, 9220000000000000, 9240000000000000, 9260000000000000, 9280000000000000, 9300000000000000, 9320000000000000, 9340000000000000, 9360000000000000, 9380000000000000, 9400000000000000, 9420000000000000, 9440000000000000, 9460000000000000, 9480000000000000, 9500000000000000, 9520000000000000, 9540000000000000, 9560000000000000, 9580000000000000, 9600000000000000, 9620000000000000, 9640000000000000, 9660000000000000, 9680000000000000, 9700000000000000, 9720000000000000, 9740000000000000, 9760000000000000, 9780000000000000, 9800000000000000, 9820000000000000, 9840000000000000, 9860000000000000, 9880000000000000, 9900000000000000, 9920000000000000, 9940000000000000, 9960000000000000, 9980000000000000, 10000000000000000, 10020000000000000, 10040000000000000, 10060000000000000, 10080000000000000, 10100000000000000, 10120000000000000, 10140000000000000, 10160000000000000, 10180000000000000, 10200000000000000, 10220000000000000, 10240000000000000, 10260000000000000, 10280000000000000, 10300000000000000, 10320000000000000, 10340000000000000, 10360000000000000, 10380000000000000, 10400000000000000, 10420000000000000, 10440000000000000, 10460000000000000, 10480000000000000, 10500000000000000, 10520000000000000, 10540000000000000, 10560000000000000, 10580000000000000, 10600000000000000, 10620000000000000, 10640000000000000, 10660000000000000, 10680000000000000, 10700000000000000, 10720000000000000, 10740000000000000, 10760000000000000, 10780000000000000, 10800000000000000, 10820000000000000, 10840000000000000, 10860000000000000, 10880000000000000, 10900000000000000, 10920000000000000, 10940000000000000, 10960000000000000, 10980000000000000, 11000000000000000, 11020000000000000, 11040000000000000, 11060000000000000, 11080000000000000, 11100000000000000, 11120000000000000, 11140000000000000, 11160000000000000, 11180000000000000, 11200000000000000, 11220000000000000, 11240000000000000, 11260000000000000, 11280000000000000, 11300000000000000, 11320000000000000, 11340000000000000, 11360000000000000, 11380000000000000, 11400000000000000, 11420000000000000, 11440000000000000, 11460000000000000, 11480000000000000, 11500000000000000, 11520000000000000, 11540000000000000, 11560000000000000, 11580000000000000, 11600000000000000, 11620000000000000, 11640000000000000, 11660000000000000, 11680000000000000, 11700000000000000, 11720000000000000, 11740000000000000, 11760000000000000, 11780000000000000, 11800000000000000, 11820000000000000, 11840000000000000, 11860000000000000, 11880000000000000, 11900000000000000, 11920000000000000, 11940000000000000, 11960000000000000, 11980000000000000, 12000000000000000, 12020000000000000, 12040000000000000, 12060000000000000, 12080000000000000, 12100000000000000, 12120000000000000, 12140000000000000, 12160000000000000, 12180000000000000, 12200000000000000, 12220000000000000, 12240000000000000, 12260000000000000, 12280000000000000, 12300000000000000, 12320000000000000, 12340000000000000, 12360000000000000, 12380000000000000, 12400000000000000, 12420000000000000, 12440000000000000, 12460000000000000, 12480000000000000, 12500000000000000, 12520000000000000, 12540000000000000, 12560000000000000, 12580000000000000, 12600000000000000, 12620000000000000, 12640000000000000, 12660000000000000, 12680000000000000, 12700000000000000, 12720000000000000, 12740000000000000, 12760000000000000, 12780000000000000, 12800000000000000, 12820000000000000, 12840000000000000, 12860000000000000, 12880000000000000, 12900000000000000, 12920000000000000, 12940000000000000, 12960000000000000, 12980000000000000, 13000000000000000, 13020000000000000, 13040000000000000, 13060000000000000, 13080000000000000, 13100000000000000, 13120000000000000, 13140000000000000, 13160000000000000, 13180000000000000, 13200000000000000, 13220000000000000, 13240000000000000, 13260000000000000, 13280000000000000, 13300000000000000, 13320000000000000, 13340000000000000, 13360000000000000, 13380000000000000, 13400000000000000, 13420000000000000, 13440000000000000, 13460000000000000, 13480000000000000, 13500000000000000, 13520000000000000, 13540000000000000, 13560000000000000, 13580000000000000, 13600000000000000, 13620000000000000, 13640000000000000, 13660000000000000, 13680000000000000, 13700000000000000, 13720000000000000, 13740000000000000, 13760000000000000, 13780000000000000, 13800000000000000, 13820000000000000, 13840000000000000, 13860000000000000, 13880000000000000, 13900000000000000, 13920000000000000, 13940000000000000, 13960000000000000, 13980000000000000, 14000000000000000, 14020000000000000, 14040000000000000, 14060000000000000, 14080000000000000, 14100000000000000, 14120000000000000, 14140000000000000, 14160000000000000, 14180000000000000, 14200000000000000, 14220000000000000, 14240000000000000, 14260000000000000, 14280000000000000, 14300000000000000, 14320000000000000, 14340000000000000, 14360000000000000, 14380000000000000, 14400000000000000, 14420000000000000, 14440000000000000, 14460000000000000, 14480000000000000, 14500000000000000, 14520000000000000, 14540000000000000, 14560000000000000, 14580000000000000, 14600000000000000, 14620000000000000, 14640000000000000, 14660000000000000, 14680000000000000, 14700000000000000, 14720000000000000, 14740000000000000, 14760000000000000, 14780000000000000, 14800000000000000, 14820000000000000, 14840000000000000, 14860000000000000, 14880000000000000, 14900000000000000, 14920000000000000, 14940000000000000, 14960000000000000, 14980000000000000, 15000000000000000, 15020000000000000, 15040000000000000, 15060000000000000, 15080000000000000, 15100000000000000, 15120000000000000, 15140000000000000, 15160000000000000, 15180000000000000, 15200000000000000, 15220000000000000, 15240000000000000, 15260000000000000, 15280000000000000, 15300000000000000, 15320000000000000, 15340000000000000, 15360000000000000, 15380000000000000, 15400000000000000, 15420000000000000, 15440000000000000, 15460000000000000, 15480000000000000, 15500000000000000, 15520000000000000, 15540000000000000, 15560000000000000, 15580000000000000, 15600000000000000, 15620000000000000, 15640000000000000, 15660000000000000, 15680000000000000, 15700000000000000, 15720000000000000, 15740000000000000, 15760000000000000, 15780000000000000, 15800000000000000, 15820000000000000, 15840000000000000, 15860000000000000, 15880000000000000, 15900000000000000, 15920000000000000, 15940000000000000, 15960000000000000, 15980000000000000, 16000000000000000, 16020000000000000, 16040000000000000, 16060000000000000, 16080000000000000, 16100000000000000, 16120000000000000, 16140000000000000, 16160000000000000, 16180000000000000, 16200000000000000, 16220000000000000, 16240000000000000, 16260000000000000, 16280000000000000, 16300000000000000, 16320000000000000, 16340000000000000, 16360000000000000, 16380000000000000, 16400000000000000, 16420000000000000, 16440000000000000, 16460000000000000, 16480000000000000, 16500000000000000, 16520000000000000, 16540000000000000, 16560000000000000, 16580000000000000, 16600000000000000, 16620000000000000, 16640000000000000, 16660000000000000, 16680000000000000, 16700000000000000, 16720000000000000, 16740000000000000, 16760000000000000, 16780000000000000, 16800000000000000, 16820000000000000, 16840000000000000, 16860000000000000, 16880000000000000, 16900000000000000, 16920000000000000, 16940000000000000, 16960000000000000, 16980000000000000, 17000000000000000, 17020000000000000, 17040000000000000, 17060000000000000, 17080000000000000, 17100000000000000, 17120000000000000, 17140000000000000, 17160000000000000, 17180000000000000, 17200000000000000, 17220000000000000, 17240000000000000, 17260000000000000, 17280000000000000, 17300000000000000, 17320000000000000, 17340000000000000, 17360000000000000, 17380000000000000, 17400000000000000, 17420000000000000, 17440000000000000, 17460000000000000, 17480000000000000, 17500000000000000, 17520000000000000, 17540000000000000, 17560000000000000, 17580000000000000, 17600000000000000, 17620000000000000, 17640000000000000, 17660000000000000, 17680000000000000, 17700000000000000, 17720000000000000, 17740000000000000, 17760000000000000, 17780000000000000, 17800000000000000, 17820000000000000, 17840000000000000, 17860000000000000, 17880000000000000, 17900000000000000, 17920000000000000, 17940000000000000, 17960000000000000, 17980000000000000, 18000000000000000, 18020000000000000, 18040000000000000, 18060000000000000, 18080000000000000, 18100000000000000, 18120000000000000, 18140000000000000, 18160000000000000, 18180000000000000, 18200000000000000, 18220000000000000, 18240000000000000, 18260000000000000, 18280000000000000, 18300000000000000, 18320000000000000, 18340000000000000, 18360000000000000, 18380000000000000, 18400000000000000, 18420000000000000, 18440000000000000, 18460000000000000, 18480000000000000, 18500000000000000, 18520000000000000, 18540000000000000, 18560000000000000, 18580000000000000, 18600000000000000, 18620000000000000, 18640000000000000, 18660000000000000, 18680000000000000, 18700000000000000, 18720000000000000, 18740000000000000, 18760000000000000, 18780000000000000, 18800000000000000, 18820000000000000, 18840000000000000, 18860000000000000, 18880000000000000, 18900000000000000, 18920000000000000, 18940000000000000, 18960000000000000, 18980000000000000, 19000000000000000, 19020000000000000, 19040000000000000, 19060000000000000, 19080000000000000, 19100000000000000, 19120000000000000, 19140000000000000, 19160000000000000, 19180000000000000, 19200000000000000, 19220000000000000, 19240000000000000, 19260000000000000, 19280000000000000, 19300000000000000, 19320000000000000, 19340000000000000, 19360000000000000, 19380000000000000, 19400000000000000, 19420000000000000, 19440000000000000, 19460000000000000, 19480000000000000, 19500000000000000, 19520000000000000, 19540000000000000, 19560000000000000, 19580000000000000, 19600000000000000, 19620000000000000, 19640000000000000, 19660000000000000, 19680000000000000, 19700000000000000, 19720000000000000, 19740000000000000, 19760000000000000, 19780000000000000, 19800000000000000, 19820000000000000, 19840000000000000, 19860000000000000, 19880000000000000, 19900000000000000, 19920000000000000, 19940000000000000, 19960000000000000, 19980000000000000, 20000000000000000};
  double nu_start[RT_NGROUPS];
  double nu_stop[RT_NGROUPS];
  for (int group = 0; group < RT_NGROUPS; group++) {
    nu_start[group] = frequency_bins[group];
  }
  for (int group = 0; group < RT_NGROUPS-1; group++) {
    nu_stop[group] = frequency_bins[group + 1];
  }
  double nu_stop_final = 1e6 * blackbody_peak_frequency(BB_temp, const_kboltz, const_planck_h);
  nu_stop[RT_NGROUPS-1] = nu_stop_final;

  struct integration_params params = {BB_temp};

  for (int g=0; g < RT_NGROUPS; g++) {
    integral_E[g] = redshift_integrate_gsl(rt_get_spectrum, nu_start[g], nu_stop[g], N_INTEGRAL_POINTS, &params);
    integral_N[g] = redshift_integrate_gsl(spectrum_over_hnu_integrand, nu_start[g], nu_stop[g], N_INTEGRAL_POINTS, &params);

    photon_energy[g] = integral_E[g]; // / integral_N[g];
    printf("[group %d] : photon_energy %.10e\n", g+1, photon_energy[g]);
    printf("[group %d] : integral_N %.10e\n", g+1, integral_N[g]);
    printf("[group %d] : integral_E %.10e\n\n", g+1, integral_E[g]);
  }
  
  
  FILE *energies_file = fopen("photon_energies", "wb");
  FILE *bins_file = fopen("frequency_bins", "wb");

  fwrite(photon_energy, sizeof(double), LEN(photon_energy), energies_file);
  fwrite(frequency_bins, sizeof(double), LEN(frequency_bins), bins_file);
  fclose(energies_file);
  fclose(bins_file);
  return EXIT_SUCCESS;
}

